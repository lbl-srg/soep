

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>4. Requirements &#8212; Spawn of EnergyPlus</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css" />
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap_custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap_custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom-sphinx.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/lbl-icon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5. Software Architecture" href="softwareArchitecture.html" />
    <link rel="prev" title="3. Conventions" href="conventions.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default ">
    <div class="container-fluid">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><img src="_static/spawn_icon_darkbluetxhighres.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="index.html">Index</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preample.html">1. Preample</a><ul>
<li class="toctree-l2"><a class="reference internal" href="preample.html#purpose-of-the-document">1.1. Purpose of the Document</a></li>
<li class="toctree-l2"><a class="reference internal" href="preample.html#contributors">1.2. Contributors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="download.html">2. Download</a><ul>
<li class="toctree-l2"><a class="reference internal" href="download.html#software">2.1. Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="download.html#publications">2.2. Publications</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="conventions.html">3. Conventions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. Requirements</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#openstudio-integration">4.1. OpenStudio integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mathematics">4.2. Mathematics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fmu-requirements">4.3. FMU Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#qss-implementation">4.4. QSS Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#master-algorithm">4.5. Master Algorithm</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="softwareArchitecture.html">5. Software Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="softwareArchitecture.html#overall-software-architecture">5.1. Overall software architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="softwareArchitecture.html#coupling-of-energyplus-with-modelica">5.2. Coupling of EnergyPlus with Modelica</a></li>
<li class="toctree-l2"><a class="reference internal" href="softwareArchitecture.html#distribution-of-spawn-and-the-modelica-buildings-library">5.3. Distribution of Spawn and the Modelica Buildings Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="softwareArchitecture.html#integration-of-qss-solver-with-optimica">5.4. Integration of QSS solver with OPTIMICA</a></li>
<li class="toctree-l2"><a class="reference internal" href="softwareArchitecture.html#integration-with-openstudio">5.5. Integration with OpenStudio</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="numericalMethods.html">6. Numerical Methods of the Master Algorithm</a><ul>
<li class="toctree-l2"><a class="reference internal" href="numericalMethods.html#time-integration">6.1. Time Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="numericalMethods.html#algebraic-loops">6.2. Algebraic Loops</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks.html">7. Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgments.html">8. Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">9. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">10. References</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">4. Requirements</a><ul>
<li><a class="reference internal" href="#openstudio-integration">4.1. OpenStudio integration</a></li>
<li><a class="reference internal" href="#mathematics">4.2. Mathematics</a><ul>
<li><a class="reference internal" href="#differentiability">4.2.1. Differentiability</a></li>
<li><a class="reference internal" href="#control-of-numerical-noise">4.2.2. Control of Numerical Noise</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fmu-requirements">4.3. FMU Requirements</a><ul>
<li><a class="reference internal" href="#fmu-capabilities">4.3.1. FMU Capabilities</a></li>
</ul>
</li>
<li><a class="reference internal" href="#qss-implementation">4.4. QSS Implementation</a></li>
<li><a class="reference internal" href="#master-algorithm">4.5. Master Algorithm</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="conventions.html" title="Previous Chapter: 3. Conventions"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 3. Conventions</span>
    </a>
  </li>
  <li>
    <a href="softwareArchitecture.html" title="Next Chapter: 5. Software Architecture"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">5. Software A... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

<!--
          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
-->
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="requirements">
<span id="sec-requirements"></span><h1>4. Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h1>
<p>This section describes the functional, mathematical and software requirements.</p>
<div class="section" id="openstudio-integration">
<h2>4.1. OpenStudio integration<a class="headerlink" href="#openstudio-integration" title="Permalink to this headline">¶</a></h2>
<p>Below is an initial list of requirements for the OpenStudio integration.</p>
<ol class="arabic">
<li><p><em>Translation of legacy models</em>: It need not be possible to translate
legacy OpenStudio HVAC models to SOEP.</p>
<p>The reason is that the control semantics is too different between the
load-based control of EnergyPlus and the control of Modelica that
is based on measurable states such as a room temperature.</p>
</li>
<li><p><em>Measures</em>: OpenStudio measures and the OpenStudio editor shall work,
after some extensions or adaptions,
with models that are authored in Modelica and subsequently
integrated in OpenStudio.</p>
<p>A use case is that a design firm creates a Modelica library
of HVAC systems and control sequences they frequently use,
and want to use them with Measures and with a schematic editor
to adapt them for a particular project.</p>
<p>Another use case is that an equipment vendor creates an OpenStudio
application for equipment selection and sizing.</p>
</li>
<li><p><em>Opening and saving a model</em>:
It shall be possible to open in the editor a model that is declared in Modelica
syntax, manipulate it, and save it again in Modelica syntax. Only items
that have been changed should be updated in the Modelica syntax.</p>
<p>A use case is that a design firm builds custom models of air handler units,
improves them during a project, and wants to save the improvements in the
library for use in the next project. As the custom library is stored in
git, only the items of the model that have been manipulated should be changed.</p>
</li>
<li><p><em>Hierarchical modeling</em>: The editor shall support hierarchical modeling.</p>
<p>A use case is that a user builds a VAV system with 50 terminal units
with custom control by creating a composite model of a VAV box plus
its controller, instantiates it 50 times, and later wants to change the
VAV controller once and propagate these changes to all instances.</p>
</li>
<li><p><em>Adding model inputs, outputs and ports</em>:
The editor shall allow enabling a conditional input to a model and connect
it to the output of another model.</p>
<p>A use case is that a user instantiates a weather data reader, sets
a parameter that enables an input signal port for the dry bulb temperature,
and connects this input to a temperature signal to model heat island effects.</p>
<p>Another use case is that a user instantiates a room controller that has
the measured room temperature as an input, and then
adds a demand response signal as an input to reset the temperature
setpoint based on the demand response signal.</p>
</li>
<li><p><em>Typed ports</em>:
To support Modelica-type connections such as Real, Integer or Boolean
control signals, and fluid ports, the OpenStudio HVAC editor
shall have typed ports.</p>
<p>A use case is that connecting a control output to a fluid port
shall be rejected by the OpenStudio model and the graphical editor.</p>
</li>
</ol>
</div>
<div class="section" id="mathematics">
<h2>4.2. Mathematics<a class="headerlink" href="#mathematics" title="Permalink to this headline">¶</a></h2>
<p>In SOEP, models are implemented in the form of Modelica models. These models
may call FMUs or C-functions for certain algorithms.
When connecting models, differential algebraic systems of equations may be formed.
Solving the algebraic equations and integrating the differential equations in time requires the equations for the continuous time
dynamics to satisfy certain smootheness properties in order for solutions to exist and to be unique.
These smoothness properties are also required for convergence and
computational efficiency of the iterative solution methods.
The next sections describe these mathematical properties that
need to be satisfied by the model equations.</p>
<div class="section" id="differentiability">
<h3>4.2.1. Differentiability<a class="headerlink" href="#differentiability" title="Permalink to this headline">¶</a></h3>
<p>Building simulation problems can be formulated as a semi-explicit
nonlinear DAE system with index one
<a class="reference internal" href="zreferences.html#brenancampbellpetzold1989" id="id1">[BCP89]</a>, coupled to the discrete variables
<span class="math notranslate nohighlight">\(x_d(\cdot)\)</span> and <span class="math notranslate nohighlight">\(u_d(\cdot)\)</span>.
The general form is <a class="reference internal" href="zreferences.html#wetter2005-1" id="id2">[Wet05]</a></p>
<div class="math notranslate nohighlight" id="equation-eq-daephy">
<span class="eqno">(4.1)<a class="headerlink" href="#equation-eq-daephy" title="Permalink to this equation">¶</a></span>\[ \begin{align}\begin{aligned}\left[\dot x_c(t), x_d(t)\right] &amp; = f(x_c(t), x_d(t^-), u_c(t), u_d(t), p, t),\\\left[y_c(t), y_d(t)\right] &amp; = g(x_c(t), x_d(t), u_c(t), u_d(t), p, t),\\0 &amp; = \gamma\bigl(u_c(t), y_c(t), y_d(t) \bigr),\\\left[x_c(t_0), x_d(t_0)\right] &amp; = (x_{c,0}, x_{d,0}),\end{aligned}\end{align} \]</div>
<p>where
<span class="math notranslate nohighlight">\(x(\cdot)\)</span> is the state vector, with superscript
<span class="math notranslate nohighlight">\(c\)</span> denoting continuous and <span class="math notranslate nohighlight">\(d\)</span> denoting discrete states,
<span class="math notranslate nohighlight">\(u(\cdot)\)</span> is the control input,
<span class="math notranslate nohighlight">\(p\)</span> are parameters,
<span class="math notranslate nohighlight">\(f(\cdot, \cdot, \cdot, \cdot, \cdot, \cdot)\)</span> is the state transitions function,
<span class="math notranslate nohighlight">\(g(\cdot, \cdot, \cdot, \cdot, \cdot, \cdot)\)</span> is the output function and
<span class="math notranslate nohighlight">\(0 = \gamma(\cdot, \cdot, \cdot)\)</span> are the algebraic constraints.
This represents algebraic loops that can be formed when connecting FMUs in a loop.</p>
<p>We will now present requirements for
existence of a unique smooth solution of the DAE System <a class="reference internal" href="#equation-eq-daephy">(4.1)</a>.
For simplicity, we assume in the analysis
<span class="math notranslate nohighlight">\(x_d(\cdot)\)</span> and
<span class="math notranslate nohighlight">\(y_d(\cdot)\)</span> to only depend on time but not on
<span class="math notranslate nohighlight">\(x_c(\cdot)\)</span> or <span class="math notranslate nohighlight">\(y_c(\cdot)\)</span>. Otherwise,
the analysis would get considerably more involved.
This allows us to simplify <a class="reference internal" href="#equation-eq-daephy">(4.1)</a> to</p>
<div class="math notranslate nohighlight" id="equation-eq-daephycon">
<span class="eqno">(4.2)<a class="headerlink" href="#equation-eq-daephycon" title="Permalink to this equation">¶</a></span>\[ \begin{align}\begin{aligned}\dot x(t) &amp; = f(x(t), \mu(t), p, t),\\0 &amp; = \gamma(x(t), \mu(t)),\\x(t_0) &amp; = x_{0},\end{aligned}\end{align} \]</div>
<p>where we omitted the subscript <span class="math notranslate nohighlight">\(c\)</span> as all variables are continuous.</p>
<p>First, we will state the requirement that allows to
establish existence, uniqueness and differentiability of
the solution <span class="math notranslate nohighlight">\(x(t_f)\)</span> to <a class="reference internal" href="#equation-eq-daephycon">(4.2)</a>.</p>
<p><strong>Requirement:</strong>
Let
<span class="math notranslate nohighlight">\(\gamma \colon \Re^n \times \Re^m \to \Re^m\)</span>
be defined as in <a class="reference internal" href="#equation-eq-daephycon">(4.2)</a>.
We assume that
<span class="math notranslate nohighlight">\(\gamma(\cdot,\cdot)\)</span> is once continuously differentiable,
and we assume that
for all
<span class="math notranslate nohighlight">\(x \in \Re^n\)</span>,
<span class="math notranslate nohighlight">\(\gamma(x(t), \cdot)=0\)</span>
has a unique solution
<span class="math notranslate nohighlight">\(\mu^*(x) \in \Re^m\)</span> and
that the matrix with partial derivatives
<span class="math notranslate nohighlight">\(\partial \gamma(x, \mu^*(x))/ \partial \mu \in \Re^{m \times m}\)</span>
is non-singular.</p>
<p>With this assumption and the use of the
Implicit Function Theorem <a class="reference internal" href="zreferences.html#pol97-1" id="id3">[Pol97]</a>, one can show that
the solution
<span class="math notranslate nohighlight">\(\mu^*(x)\)</span> that satisfies
<span class="math notranslate nohighlight">\(\gamma(x, \mu^*(x) )=0\)</span>,
is unique and once continuously differentiable in
<span class="math notranslate nohighlight">\(x\)</span>.</p>
<p>Therefore, to establish existence, uniqueness and differentiability
of <span class="math notranslate nohighlight">\(x(t_f)\)</span>, we can reduce the DAE system <a class="reference internal" href="#equation-eq-daephycon">(4.2)</a>
to an ordinary differential
equation, which will allow us to use standard results from the
theory of ordinary differential equations.
To do so, we define for <span class="math notranslate nohighlight">\(t \in [t_0, \, t_f]\)</span>
the function</p>
<div class="math notranslate nohighlight" id="equation-eq-tilfdef">
<span class="eqno">(4.3)<a class="headerlink" href="#equation-eq-tilfdef" title="Permalink to this equation">¶</a></span>\[\widetilde f(x(t), p, t) \triangleq f(x(t), \mu^*(x), p, t)\]</div>
<p>and write the DAE system <a class="reference internal" href="#equation-eq-daephycon">(4.2)</a> in the form</p>
<div class="math notranslate nohighlight" id="equation-eq-tilfsys">
<span class="eqno">(4.4)<a class="headerlink" href="#equation-eq-tilfsys" title="Permalink to this equation">¶</a></span>\[ \begin{align}\begin{aligned}\dot x(t) &amp; = \widetilde f(x(t), p, t),\\x(t_0) &amp; = x_{0}.\end{aligned}\end{align} \]</div>
<p>We will use the notation
<span class="math notranslate nohighlight">\(\widetilde f_{x}(x(t), p, t)\)</span> and
<span class="math notranslate nohighlight">\(\widetilde f_{p}(x(t), p, t)\)</span>
for the partial derivatives
<span class="math notranslate nohighlight">\((\partial/\partial x)(\widetilde f(x(t), p, t)\)</span> and
<span class="math notranslate nohighlight">\((\partial/\partial p)(\widetilde f(x(t), p, t)\)</span>, respectively.</p>
<p><strong>Requirement:</strong>
With <span class="math notranslate nohighlight">\(\widetilde f(\cdot, \cdot, \cdot)\)</span>
as in
<a class="reference internal" href="#equation-eq-tilfsys">(4.4)</a>, we require that</p>
<blockquote>
<div><ol class="arabic">
<li><p>The initial condition <span class="math notranslate nohighlight">\(x_{0}\)</span> is once continuously differentiable in <span class="math notranslate nohighlight">\(p\)</span>.</p></li>
<li><p>There exists a constant <span class="math notranslate nohighlight">\(K \in [1, \, \infty)\)</span> such that for all
<span class="math notranslate nohighlight">\(x', x'' \in \Re^n\)</span>, for all <span class="math notranslate nohighlight">\(p', p'' \in \Re^l\)</span> and for all <span class="math notranslate nohighlight">\(t\)</span>, the following relations hold:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\| \widetilde f(x', p', t) - \widetilde f(x'', p'', t) \| &amp;
\le K \, (\| x' - x'' \| + \| p' - p'' \| ),\\\| \widetilde f_{x}(x', p', t) - \widetilde f_{x}(x'', p'', t) \| &amp;
\le K \, (\| x' - x'' \| + \| p' - p'' \| ),\end{aligned}\end{align} \]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[\| \widetilde f_p(x', p', t) - \widetilde f_p(x'', p'', t) \|
\le K \, (\| x' - x'' \| + \| p' - p'' \| ).\]</div>
</li>
</ol>
</div></blockquote>
<p>With these conditions, it follows as a special case of Corollary 5.6.9 in <a class="reference internal" href="zreferences.html#pol97-1" id="id4">[Pol97]</a>,
that the solution
<span class="math notranslate nohighlight">\(x(t_f)\)</span> to <a class="reference internal" href="#equation-eq-daephycon">(4.2)</a> exists and is once continuously differentiable with
respect to the parameter <span class="math notranslate nohighlight">\(p\)</span> on bounded sets.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Differentiability with respect to <span class="math notranslate nohighlight">\(p\)</span> is important
if the HVAC system
is sized by solving an optimization problem.</p>
</div>
</div>
<div class="section" id="control-of-numerical-noise">
<h3>4.2.2. Control of Numerical Noise<a class="headerlink" href="#control-of-numerical-noise" title="Permalink to this headline">¶</a></h3>
<p>Evaluating the functions
<span class="math notranslate nohighlight">\(f(\cdot, \cdot, \cdot, \cdot, \cdot, \cdot)\)</span>,
<span class="math notranslate nohighlight">\(g(\cdot, \cdot, \cdot, \cdot, \cdot, \cdot)\)</span> and
<span class="math notranslate nohighlight">\(F(\cdot, \cdot, \cdot, \cdot, \cdot, \cdot, \cdot)\)</span>
may require iterations inside the component, which may be realized as an FMUs,
that implement these functions.
These iterations typically terminate when a convergence test is satisfied.
In such cases, the state derivatives
<span class="math notranslate nohighlight">\(\dot x_c(t)\)</span> and
the outputs
<span class="math notranslate nohighlight">\(y_c(t)\)</span> may not be computed exactly.
For example, if <span class="math notranslate nohighlight">\(z(t)\)</span> denotes a continuous state (or state derivative or output), one can only compute a numerical approximation
<span class="math notranslate nohighlight">\(z^*(t; \epsilon)\)</span>, where <span class="math notranslate nohighlight">\(\epsilon\)</span> is the tolerance setting of the numerical solver.
The precision of these inner iterations need to be controlled</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>when these FMUs are part of an algebraic loop, and</p></li>
<li><p>when SOEP is used to evaluate the cost function of an optimization problem.</p></li>
</ol>
</div></blockquote>
<p>We therefore impose the following requirement.</p>
<p><strong>Requirement:</strong>
We require that the FMUs allow controlling the numerical precision.
Specifically, for any <span class="math notranslate nohighlight">\(t \in [t_0, t_f]\)</span>, there need to exist
an <span class="math notranslate nohighlight">\(\epsilon' &gt; 0\)</span> and a strictly monotone increasing function
<span class="math notranslate nohighlight">\(\varphi \colon \Re \to \Re\)</span>, such that</p>
<div class="math notranslate nohighlight" id="equation-eq-errbousol">
<span class="eqno">(4.5)<a class="headerlink" href="#equation-eq-errbousol" title="Permalink to this equation">¶</a></span>\[\| z(t) - z^*(t, \epsilon) \| \le \varphi(\epsilon)\]</div>
<p>for all <span class="math notranslate nohighlight">\(0 &lt; \epsilon &lt; \epsilon'\)</span>.</p>
<p>Note that this means that as the tolerance of the solver is decreased, the numerical error decreases.
This requirement allows proving convergence to a first order
optimal point for a class of derivative-free optimization
algorithms <a class="reference internal" href="zreferences.html#polakwetter2006" id="id5">[PW06]</a>.</p>
</div>
</div>
<div class="section" id="fmu-requirements">
<span id="sec-fmu-cap"></span><h2>4.3. FMU Requirements<a class="headerlink" href="#fmu-requirements" title="Permalink to this headline">¶</a></h2>
<p>The FMI standard contains various properties that it declares optional to implement.</p>
<div class="section" id="fmu-capabilities">
<h3>4.3.1. FMU Capabilities<a class="headerlink" href="#fmu-capabilities" title="Permalink to this headline">¶</a></h3>
<p>For computing efficiency, FMUs that are used in the SOEP must support
the following optional properties of the FMI 2.0 standard.</p>
<ol class="arabic simple">
<li><p>The optional function <code class="docutils literal notranslate"><span class="pre">fmi2GetDirectionalDerivative</span></code> must be
implemented. This is required in the following situations:</p>
<ol class="arabic simple">
<li><p>To compute Jacobian matrices without requiring numerical
differentiation.</p></li>
<li><p>By numerical integrators for stiff differential equation,
other than the LIQSS methods discussed below.</p></li>
<li><p>If an FMU is part of an algebraic loop.</p></li>
<li><p>If an FMU, or a composition of FMUs, shall be linearized,
such as for controls design.</p></li>
</ol>
</li>
<li><p>The optional output dependency must be provided in the section
<code class="docutils literal notranslate"><span class="pre">&lt;ModelStructure&gt;&lt;Outputs&gt;</span></code> of the model description file.
This is required to determine the existence of algebraic loops
between FMUs.</p></li>
<li><p>The optional derivative dependency must be provided in the section
<code class="docutils literal notranslate"><span class="pre">&lt;ModelStructure&gt;&lt;Derivatives&gt;</span></code> of the model description file.
This information declares the dependencies of the state derivatives
on the knowns at the current time instant for model exchange and at
the current communication point for co-simulation.
This is required to create an incidence matrix which can be used by
an integrator.</p></li>
<li><p>The optional attribute <code class="docutils literal notranslate"><span class="pre">canGetAndSetFMUstate</span></code> must be <code class="docutils literal notranslate"><span class="pre">true</span></code>
in the model description file. This implies that the
functions <code class="docutils literal notranslate"><span class="pre">fmi2GetFMUstate</span></code>, <code class="docutils literal notranslate"><span class="pre">fmi2SetFMUstate</span></code> and
<code class="docutils literal notranslate"><span class="pre">fmi2FreeFMUstate</span></code> must be implemented. This is required
for the following situations:</p>
<ol class="arabic simple">
<li><p>To implement rollback in time when an FMU was not able to
complete the time step, maybe due to an event, or if the
integration error was too large.</p></li>
<li><p>To provide a state initialization when solving a
model predictive control problem or when doing an
input-output linearization.</p></li>
</ol>
</li>
<li><p>If an FMU for co-simulation accepts a certain communication time
step <span class="math notranslate nohighlight">\(h\)</span> (i.e., it returns that it can simulate to
<span class="math notranslate nohighlight">\(h' = h\)</span> ), or at least makes partial progress until
<span class="math notranslate nohighlight">\(h' &lt; h\)</span>, then it must accept any time step
<span class="math notranslate nohighlight">\(h''\)</span> smaller than or equal to <span class="math notranslate nohighlight">\(h'\)</span>,
provided the FMU is started from the same state.
This is required for proving termination of the master algorithm.
See <a class="reference internal" href="zreferences.html#broman2013" id="id6">[BBG+13]</a>.</p></li>
<li><p>If an FMU for co-simulation is asked to integrate for some
<span class="math notranslate nohighlight">\(0 &lt; h\)</span>, but it returns that it can only integrate until some
<span class="math notranslate nohighlight">\(0 &lt; h' &lt; h\)</span>, then if it is asked to integrate
to some <span class="math notranslate nohighlight">\(h''&gt;h'\)</span>, it will again only integrate until
<span class="math notranslate nohighlight">\(h'\)</span>.
This property is required for FMUs to make maximum progress
in each time step. See <a class="reference internal" href="zreferences.html#broman2013" id="id7">[BBG+13]</a>.</p></li>
<li><p>FMUs distributed with SOEP must run on Windows 64 bit, Linux 64 bit
and Mac OS X 64 bit.</p></li>
</ol>
</div>
</div>
<div class="section" id="qss-implementation">
<h2>4.4. QSS Implementation<a class="headerlink" href="#qss-implementation" title="Permalink to this headline">¶</a></h2>
<p>This section describes the requirements for the QSS solver implementation.
The development code for QSS is at <a class="reference external" href="https://github.com/NREL/SOEP-QSS">https://github.com/NREL/SOEP-QSS</a>.</p>
<ol class="arabic simple">
<li><p>The implementation shall support the ability to mix traditional discrete time
simulation of some subsystems with QSS solution of others.</p></li>
<li><p>For different subsystems, it shall be possible to use different QSS solvers,
such as QSS1, 2, 3, or LIQSS1, 2 or 3.</p></li>
<li><p>It shall be possible to specify absolute and relative tolerances for the quantization.
(Note: In Modelica, vendor annotations could be used to specify tolerances.)</p></li>
<li><p>If multiple variables end up triggering the next advance with the exact same time,
then these shall be handled simultaneously.
An example are distributed discrete time controls.</p></li>
<li><p>Near zero time steps shall be handled without modification.
If these pose a problem, we may want to avoid them at a later stage in the solver.</p></li>
<li><p>Algebraic loops shall be supported (without the use of micro-delays).</p></li>
</ol>
</div>
<div class="section" id="master-algorithm">
<h2>4.5. Master Algorithm<a class="headerlink" href="#master-algorithm" title="Permalink to this headline">¶</a></h2>
<p>The master algorithm must satisfy the following requirements:</p>
<ol class="arabic simple">
<li><p>The master algorithm must be using the BSD license. Hence,
it must not use any GPL or LGPL licensed code.
However, calls to such licensed code may be permitted
as long as it does not affect the license of the master
algorithm.</p></li>
<li><p>It must be possible to spawn simulations to a server farm
in order to increase the parallelism. By default,
the computations run locally.</p></li>
<li><p>It must be possible to simulate very large buildings,
such as high rise buildings with about 10,000 thermal zones.
This is required to be able to simulate models that
are received from a Building Information Model.
We therefore expect to have models with 100,000 to 1,000,000
state variables, or more if 2-dimensional heat transfer,
dynamic moisture transfer, or computational fluid
dynamics is used.</p></li>
<li><p>If an FMU that computes some part of a building
does not converge, then the master algorithm must
be able to use some default output, log an appropriate
warning, and proceed with the computation. This must be
the default behavior. However, it must be possible
to disable this error handling so that a completion of
the simulation is only possible if all FMUs
simulated without error.</p></li>
<li><p>The master algorithm must run on Windows 64 bit,
Linux 64 bit, and Mac OS X 64 bit.</p></li>
</ol>
</div>
</div>


    </div>
      
  </div>
</div>
  
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright (c) All rights reserved.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.<br/>
    </p>
  </div>
</footer>

  </body>
</html>